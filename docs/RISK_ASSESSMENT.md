# Security & Operational Risk Assessment

This document establishes the mandatory security protocols for the deployment and operation of **LibreControl**. Given the nature of Command and Control (C2) frameworks, the risk profile is twofold:

1. **Inbound Risk**: The C2 infrastructure itself is a high-value target for rival threat actors or counter-intelligence operations. Vulnerabilities here can lead to the operator's compromise.
2. **Outbound Risk**: Operational mistakes can lead to legal liability, attribution, or unintended damage to target infrastructure.

> [!NOTE]
> This framework is provided "as-is" for educational purposes. The safeguards described herein are the sole responsibility of the operator.

## Infrastructure Security (AppSec & NetSec)

The architecture relies on strict isolation. Deviating from the default `docker-compose` topology introduces critical vulnerabilities.

### Network Segregation

The **Team Server** and **Database** reside in a trusted zone. They **MUST NOT** be directly reachable from the public internet.

- **Requirement**: Ensure the `docker-compose` network `c2_grid` is set to `internal: true` or strictly firewalled.
- **Redirectors**: Never expose a Listener directly to the target. Use a "Redirector" (Reverse Proxy like Nginx/Apache) on a separate VPS to forward traffic to the Listener. If the Redirector is burned, the Listener remains hidden.

### Secrets Management

The framework utilizes cryptographic secrets for authentication and encryption.

- **JWT Secret**: The environment variable `JWT_SECRET` in `docker-compose.yml` defaults to a placeholder. **CRITICAL**: Change this before first launch. Failure to do so allows any attacker to forge a token and take full control of your C2.
- **Database Credentials**: The DBMS password must be strong (minimum 20 characters, high entropy).

### Input Sanitization & RCE

While LibreControl implements input validation, C2 servers are historically vulnerable to "Hot Patching" attacks where a malicious Agent sends a malformed response to exploit the Server.

> [!NOTE]
> Treat all data coming from the Agent as **Untrusted Input**. The parsing logic in `internal/listener` is the primary attack surface.

## Cryptographic Hygiene

The security of the communications depends entirely on the secrecy of the cryptographic keys.

### Key Lifecycle

- **Static Keys**: The Server's Private Key ($S_{priv}$) is generated at startup. If this key is exfiltrated (e.g., compromised server), all historical traffic captured by defenders can be potentially decrypted if Forward Secrecy was not perfectly implemented or if the attacker acts as a Man-in-the-Middle during the handshake.
- **Rotation**: Periodic rotation of the Server's keys is recommended for long-term operations. This requires recompiling and redeploying agents.

### Artifact Signatures

- **Binary Analysis**: The agents generated by `cmd/factory` are un-obfuscated Go binaries. They contain recognizable strings and signatures.
- **Risk**: Modern EDR (Endpoint Detection & Response) solutions will flag these binaries immediately. Do not assume the "Encryption" of network traffic hides the "Nature" of the binary on disk.

## Operational Security (OpSec)

### Attribution & Origin

- **Source IP**: Never operate the Console (`cmd/teamserver` API) from your home or corporate IP address. Use a VPN or Tor to connect to the management interface.
- **Fingerprinting**: The default HTTP headers of the Listeners identify the server as LibreControl. You **MUST** configure the Malleable Profiles to mimic legitimate servers (e.g., Apache/2.4.50) to avoid easy censorship by Blue Teams.

### Deconfliction & Logs

- **Traceability**: The `internal/database` maintains an immutable log of every command issued.
- **Protocol**: In an authorized Red Team engagement, you must be able to provide these logs to the client to prove exactly what actions were taken. **DO NOT DELETE LOGS** during an active operation; they are your legal shield against accusations of damages you did not commit.

## Legal Boundaries & Ethics

1. **Authorization**: You must possess written, signed authorization (Scope of Work) from the owner of the target infrastructure before deploying an Agent.
2. **Scope Creep**: Do not pivot to networks or systems outside the agreed scope, even if they are accessible from the compromised host.
3. **Data Privacy**: Avoid exfiltrating PII (Personally Identifiable Information) unless explicitly required by the engagement objectives. If PII is inadvertently captured (e.g., in a screenshot), it must be securely deleted immediately.

> [!CAUTION]
> Violation of these parameters may constitute a criminal offense.

## Incident Response (Self-Compromise)

If you suspect the C2 infrastructure has been compromised by a third party:

1. **Kill Switch**: Execute the `docker-compose down -v` command immediately to sever connections.
2. **Burn**: Assume all deployed agents are now controlled by the adversary. You must manually remediate the target hosts (using the incident response contact established in the Rules of Engagement).
3. **Rotate**: Generate entirely new cryptographic keys before rebuilding the infrastructure.